<?xml version="1.0" encoding="UTF-8"?>
<UpdateRoot xmlns="N_DATA_MODEL_HLFT" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			testId="TS_CPDLC-047-04"
			testTitle="CPDLC message timeout alert (CPDLC connection status validation)"
			testObjective="This test verifies that SKYRADAR generates CPDLC timeout alerts only when track has active CPDLC connection with CONNECTED logon status and CURRENT data authority.&#xa;
			Conditions for CPDLC timeout alert generation are:&#xa;
1) The CPDLC system status is equal to OPERATIONAL. &#xa;
2) The track has an active CPDLC connection with logon status set to CONNECTED and data authority is CURRENT. &#xa;
3) A CPDLC uplink message of type CLEARANCE or INSTRUCTION has been transmitted to the aircraft with message status equal to SENT. &#xa;
4) The elapsed time since message transmission exceeds the response timeout threshold (CPDLC_RESPONSE_TIMEOUT). &#xa;
5) No CPDLC downlink response (WILCO, UNABLE, STANDBY, or ROGER) has been received from the aircraft for the pending message. &#xa;
6) The message criticality level is set to HIGH or SAFETY_CRITICAL requiring mandatory acknowledgment. &#xa;
7) The flag CPDLC_VOICE_BACKUP_ENABLED is set to true and the controller position has active voice communication capability.&#xa;
- 1st step: CPDLC connection logon status is DISCONNECTED, timeout exceeded, no alert should be generated.&#xa;
- 2nd step: CPDLC connection transitions to CONNECTED with CURRENT data authority, timeout alert should be generated.&#xa;
&#xa;
System status=OPERATIONAL. Message type=CLEARANCE. Elapsed time=65s > 60s timeout. Criticality=HIGH. Voice backup=true.&#xa;
All conditions are met except connection status, which transitions from DISCONNECTED to CONNECTED."
			requirement1="SKYRADAR-CPDLC-047" requirementCMATS1="SKYRADAR-CPDLC-047"
			historyDate1="15/09/2024"
			historyDate2="12/11/2024"
			historyEcrId1="CMATS_ISD91"
			historyEcrId2="FRSKYRADAR-8223"
			historyVersion1="4.2"
			actionComment="CPDLC connection status transitions from DISCONNECTED to CONNECTED. Message timeout exceeded."
			actionDescription="Track has pending CPDLC message that has exceeded timeout. CPDLC connection status determines whether timeout alert is generated.">

	<FlightPlanUpdate recNum="1" time="1" callsign="AFR654" cfl="370" cflUnity="F" arrivalRwy="27R" arrivalAirport="LFPG" isControlled="true" flightRules="I"/>

	<IdentUpdate recNum="1" time="2" callsign="AFR654" couplingStatus="AUTO" fplNum="1" sysTrackNum="1"/>

	<CpdlcSystemUpdate time="3">
		<CpdlcStatus status="OPERATIONAL" voiceBackupEnabled="true"/>
	</CpdlcSystemUpdate>

	<CpdlcConnectionUpdate time="4">
		<Connection trackNum="1" logonStatus="DISCONNECTED" dataAuthority="NONE" voiceFrequency="119.25" voiceCapability="ACTIVE"/>
	</CpdlcConnectionUpdate>

	<CpdlcMessageUpdate time="5000">
		<UplinkMessage trackNum="1" messageId="MSG_005" messageType="CLEARANCE" messageContent="CLEARED TO LFPG VIA OKIPA" messageStatus="SENT" transmissionTime="5000" criticalityLevel="HIGH" responseTimeout="60000" responseReceived="false"/>
	</CpdlcMessageUpdate>

	<TrackUpdates time="5100">
		<TrackUpdate trackNumber="1" measFlightLevel="37000" measFlightLevelAge="0" posX="50" posY="80" cartSpeedX="190" cartSpeedY="-25" identStr="1" baroAltitude="37000" baroAltitudeQNHCor="0" rocRodRate="0" altitudeQuality="HIGH" flightPhase="CRUISE">
			<Mode3A value="3456"/>
			<FlightPlan callsign="AFR654" ifpsFlightId="1" airportArr="LFPG" flightCatFr1Fr2="0" runway="27R"/>
			<Ident sac="118" sic="220"/>
			<SysTrkAge ssrAge="0"/>
		</TrackUpdate>
	</TrackUpdates>

	<TestResult resultTimeInMilliSec="70000" resultDescription="No CPDLC timeout alert is generated because CPDLC connection logon status is DISCONNECTED (elapsed time 65s > 60s timeout, but connection not CONNECTED)."
				nextActionComment="At time 75000ms, CPDLC connection transitions to CONNECTED status with CURRENT data authority.&#xa;
				Elapsed time is now 70s, still exceeding the 60s timeout."
				nextActionDescription="CPDLC connection becomes CONNECTED with CURRENT data authority. With timeout already exceeded, alert should be generated.">
		<Alerts alertType="CPDLC_TIMEOUT" trackNum="1" alertGenerated="false"/>
	</TestResult>

	<!-- MISSING: The CpdlcConnectionUpdate that should change logon status to CONNECTED is MISSING here! -->
	<!-- This should be: <CpdlcConnectionUpdate time="75000"><Connection trackNum="1" logonStatus="CONNECTED" dataAuthority="CURRENT" voiceFrequency="119.25" voiceCapability="ACTIVE"/></CpdlcConnectionUpdate> -->

	<TrackUpdates time="75100">
		<TrackUpdate trackNumber="1" measFlightLevel="37000" measFlightLevelAge="0" posX="62" posY="76" cartSpeedX="190" cartSpeedY="-25" identStr="1" baroAltitude="37000" baroAltitudeQNHCor="0" rocRodRate="0" altitudeQuality="HIGH" flightPhase="CRUISE">
			<Mode3A value="3456"/>
			<FlightPlan callsign="AFR654" ifpsFlightId="1" airportArr="LFPG" flightCatFr1Fr2="0" runway="27R"/>
			<Ident sac="118" sic="220"/>
			<SysTrkAge ssrAge="0"/>
		</TrackUpdate>
	</TrackUpdates>

	<TestResult resultTimeInMilliSec="75500" resultDescription="CPDLC timeout alert is generated because CPDLC connection is CONNECTED with CURRENT data authority and elapsed time (70s) exceeds timeout (60s).">
		<Alerts alertType="CPDLC_TIMEOUT" trackNum="1" alertGenerated="true">
			<CpdlcTimeoutAlert severity="WARNING" messageId="MSG_005" elapsedTime="70" timeout="60" voiceReversionTriggered="true"/>
		</Alerts>
	</TestResult>
</UpdateRoot>
